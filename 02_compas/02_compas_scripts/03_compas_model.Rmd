---
title: "Diabetes - Modelling"
author: "Simon Schrauth"
date: "`r Sys.Date()`"
output: html_document
---
# Model Diabetes Dataset

## Goal

After executing this script, a deep neural network for the diabetes dataset should be modelled.

## Load R packages

```{r}
pacman::p_load(tidyverse, 
               here,
               reticulate)
```

## Activate Python environment

```{r}
reticulate::use_condaenv(condaenv = "Masterarbeit", 
                         required = TRUE
                         )
```

## Import Python packages

```{python}
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.model_selection import train_test_split
from sklearn import preprocessing
```


## Load data

```{r}
diab_data_clean = readRDS(file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                                      "02_diabetes_data_clean.rds"))
```

## Get names of categorical variables

```{r}
diab_cat_varnames = diab_data_clean %>% 
  select(where(is.factor)) %>% 
  colnames()
```


## Transform to python data frame

```{python}
diab_data_clean = r.diab_data_clean
diab_cat_varnames = r.diab_cat_varnames
```


## Preparation of the dataset

### Ratios for training, testing and validation set
```{python}
diab_train_ratio = 0.75
diab_validation_ratio = 0.15
diab_test_ratio = 0.1
```


### Train-test-split for training and testing datasets
```{python}
diab_X_train_raw, diab_X_test_raw, diab_y_train, diab_y_test = train_test_split(diab_data_clean.iloc[:,:-1], 
                                                                                diab_data_clean.iloc[:,-1], 
                                                                                test_size=diab_test_ratio,
                                                                                random_state=42,
                                                                                shuffle = True)
```

### Train-test-split for training and validation datasets
```{python}
diab_X_train_raw, diab_X_val_raw, diab_y_train, diab_y_val = train_test_split(diab_X_train_raw, 
                                                                              diab_y_train, 
                                                                              test_size=diab_validation_ratio/(1-diab_test_ratio),
                                                                              random_state=24,
                                                                              shuffle = True)
```

### Reset all indices
```{python}
diab_X_train_raw = diab_X_train_raw.reset_index(drop=True)
diab_y_train = diab_y_train.reset_index(drop=True)

diab_X_val_raw = diab_X_val_raw.reset_index(drop=True)
diab_y_val = diab_y_val.reset_index(drop=True)

diab_X_test_raw = diab_X_test_raw.reset_index(drop=True)
diab_y_test = diab_y_test.reset_index(drop=True)
```

### One-hot-encoding of training data
```{python}
diab_X_train = pd.get_dummies(diab_X_train_raw, 
                                   columns = diab_cat_varnames, 
                                   drop_first = False, 
                                   dtype="int64")
                              
diab_X_train = diab_X_train.astype(float)
```

### One-hot-encoding of validation data
```{python}
diab_X_val = pd.get_dummies(diab_X_val_raw, 
                                 columns = diab_cat_varnames, 
                                 drop_first = False, 
                                 dtype="int64")
                            
diab_X_val = diab_X_val.astype(float)
```

### One-hot-encoding of testing data
```{python}
diab_X_test = pd.get_dummies(diab_X_test_raw, 
                                  columns = diab_cat_varnames, 
                                  drop_first = False, 
                                  dtype="int64")
                            
diab_X_test = diab_X_test.astype(float)
```

### Save column names for interpretation
```{python}
diab_col_names_enc = diab_X_train.columns.values.tolist()
```

```{python}
diab_X_train
diab_y_train

diab_X_val
diab_y_val

diab_X_test
diab_y_test

#diab_col_names_enc
```

### Save as RDS
```{r}
diab_X_train = py$diab_X_train
saveRDS(diab_X_train, 
        file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                    "03_diabetes_data_model_X_train.rds")
        )

diab_y_train = py$diab_y_train
saveRDS(diab_y_train, 
        file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                    "04_diabetes_data_model_y_train.rds")
        )

diab_X_val = py$diab_X_val
saveRDS(diab_X_val, 
        file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                    "05_diabetes_data_model_X_val.rds")
        )

diab_y_val = py$diab_y_val
saveRDS(diab_y_val, 
        file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                    "06_diabetes_data_model_y_val.rds")
        )

diab_X_test = py$diab_X_test
saveRDS(diab_X_test, 
        file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                    "07_diabetes_data_model_X_test.rds")
        )

diab_y_test = py$diab_y_test
saveRDS(diab_y_test, 
        file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                    "08_diabetes_data_model_y_test.rds")
        )

diab_col_names_enc = py$diab_col_names_enc
saveRDS(diab_col_names_enc, 
        file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                    "09_diabetes_data_model_col_names_enc.rds")
        )
```

### Load RDS
```{r, eval=FALSE}
diab_X_train = readRDS(file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                              "03_diabetes_data_model_X_train.rds"))

diab_y_train = readRDS(file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                              "04_diabetes_data_model_y_train.rds"))

diab_X_val = readRDS(file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                            "05_diabetes_data_model_X_val.rds"))

diab_y_val = readRDS(file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                            "06_diabetes_data_model_y_val.rds"))

diab_X_test = readRDS(file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                             "07_diabetes_data_model_X_test.rds"))

diab_y_test = readRDS(file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                             "08_diabetes_data_model_y_test.rds"))

diab_col_names_enc = readRDS(file = here("01_diabetes", "01_diabetes_data", "02_diabetes_data_processed",
                                    "09_diabetes_data_model_col_names_enc.rds"))
```

Transfer to python
```{python, eval=FALSE}
diab_X_train = r.diab_X_train
diab_y_train = r.diab_y_train

diab_X_val = r.diab_X_val
diab_y_val = r.diab_y_val

diab_X_test = r.diab_X_test
diab_y_test = r.diab_y_test

diab_col_names_enc = r.diab_col_names_enc
```

